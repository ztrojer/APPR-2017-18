---
title: "Analiza proizvodnje električne energije"
author: "Žiga Trojer"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding = "UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding = "UTF-8")
```

# Izbira teme

Raziskoval bom proizvodnjo in porabo električne energije v Sloveniji in Evropi. Raziskoval bom, kako vpliva vse večje vključevanje "zelenih" porabnikov energije - električnih vozil in toplotnih črpalk na proizvodnjo energije. Opazoval bom trend trajnostne energije. Zanimajo me države, ki najbolj zmanjšujejo odvisnost od fosilnih virov energije ter zagotavljajo možnosti za zmanjševanje toplogrednih plinov.

Odgovoril bom na naslednja vprašanja:

    1. kako bo prodaja električnih vozil vplivala na proizvodnjo električne energije,
    2. iz katerih virov bo proizvedene največ energije čez določeno obdobje,
    3. kdaj se lahko spet pojavi energetska kriza (električna energija).


### Podatkovni viri 

1. http://www.energetika-portal.si/statistika/ (.CSV)
2. http://pxweb.stat.si/pxweb/Database/Okolje/Okolje.asp#18 (.CSV)
3. https://www.destatis.de/EN/FactsFigures/EconomicSectors/Energy/Production/Tables/TablesElectricity.html (.HTML)
4. http://ec.europa.eu/eurostat/web/energy/data/main-tables (.CSV)
5. http://www.eafo.eu/vehicle-statistics/m1 (.HTML)


***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz.r", encoding = "UTF-8")
```

Uvozili smo podatke iz različnih virov (Eurostat (.CSV), drugi viri (.HTML in .JSON)).

1. `tabela1` - podatki o proizvodnji električne energije v EU po proizvodnih delih
  - `leto` - spremenljivka: leto,
  - `drzava` - spremenljivka: ime države,
  - `tip` - spremenljivka: proizvodni del - tip elektrarne,
  - `vrednost` - meritev: proizvedena električna energija (v terajoulih).

2. `tabela2` - podatki o porabi električne energije v EU po panogi
  - `leto` - spremenljivka: leto,
  - `drzava` - spremenljivka: ime države,
  - `tip` - spremenljivka: panoga,
  - `vrednost` - meritev: poraba električna energija (v terajoulih).
  
3. `tabela3` - podatki o  proizvodnji energije iz obnovljivih virov
  - `leto` - spremenljivka: leto,
  - `drzava` - spremenljivka: ime države,
  - `produkt` - spremenljivka: vir proizvodnje energije,
  - `vrednost` - meritev: proizvedena energija (v terajoulih).
  
4. `tabela4` - podatki o  prodaji električnih vozil v Evropi
  - `model` - spremenljivka: znamka in model avtomobila,
  - `leto` - spremenljivka: leto prodaje,
  - `vrednost` - meritev: število prodanih avtomobilov.
  
5. `tabela5` - podatki o  prodaji električnih vozil - hibridov v Evropi
  - `model` - spremenljivka: znamka in model avtomobila,
  - `leto` - spremenljivka: leto prodaje,
  - `vrednost` - meritev: število prodanih avtomobilov.
  
6. `tabela6` - podatki o  deležu električne energije iz obnovljivih virov
  - `leto` - spremenljivka: leto,
  - `drzava` - spremenljivka: ime države,
  - `vrednost` - meritev: delež električne energije iz obnovljivih virov.
  
7. `tabela7` - podatki o  porabi električne energije za toplotne črpalke
  - `leto` - spremenljivka: leto,
  - `drzava` - spremenljivka: ime države,
  - `vrednost` - meritev: poraba električne energije za toplotne črpalke.

Spodnji graf prikazuje porazdelitev števila naselij v občinah.

```{r histogram, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Histogram števila naselij v občinah'}
ggplot(obcine, aes(x = naselja)) + geom_histogram() +
  ggtitle("Pogostost števila naselij") + xlab("Število naselij") + ylab("Število občin")
```

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE}
source("vizualizacija/vizualizacija.r", encoding = "UTF-8")
```

Spodnji zemljevid prikazuje povprečno velikost družine za vsako občino.

```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
ggplot() + geom_polygon(data = left_join(zemljevid, povprecja, by = c("OB_UIME" = "obcina")),
                        aes(x = long, y = lat, group = group, fill = povprecje)) +
  ggtitle("Povprečno število otrok v družini") + xlab("") + ylab("") +
  guides(fill = guide_colorbar(title = "Povprečje"))
```

***

# Napredna analiza podatkov

```{r analiza, echo=FALSE, message=FALSE}
source("analiza/analiza.r", encoding = "UTF-8")
```

Spodnji graf prikazuje povezavo med številom naselij in površino občine.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
ggplot(inner_join(obcine, data.frame(obcina = names(skupine),
                                     skupina = factor(skupine)), by = "obcina")
, aes(x = povrsina, y = naselja, color = skupina, size = prebivalci/1000)) + geom_point() +
  ggtitle("Število naselij glede na površino občine") +
  xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
  guides(color = guide_legend(title = "Skupina"),
         size = guide_legend(title = "Prebivalci (* 1000)"))
```

***

```{r shiny, echo = FALSE}
shinyAppDir("shiny", options=list(width="100%", height=600))
```
